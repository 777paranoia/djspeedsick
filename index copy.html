<!DOCTYPE html>
<head>
  <html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>DJSPEEDSICK.COM</title>
  <meta name="description" content="DJSPEEDSICK.COM">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <script type="text/javascript" src="lodash.js"></script>
  <script type="text/javascript" src="butterchurn.js"></script>
  <script type="text/javascript" src="butterchurnPresets.min.js"></script>
  <script type="text/javascript" src="butterchurn-presets/lib/butterchurnPresetsExtra.min.js"></script>
  <script src="jquery-3.1.1.min.js"></script>
  <style>
    #canvass:-moz-full-screen, #canvass:-webkit-full-screen, #canvass:-ms-fullscreen, #canvass:fullscreen {
      width: 100%;
      height: 100%;
    }
    #presetSelect { max-width: 300px; }
    #presetCycleLength { width: 25px; }
    * { margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; }
    canvas { display: block; height: 100vh; width: 100vw; }
  </style>
</head>
<body style="width:100%; height:100%;">
  <div id="mainWrapper">
    <div id="LxSettings" style="display:none;">
      <div id="audioSelectWrapper">
        <div id="localFileBut"><span>Load local files</span></div>
        <div id="micSelect"><span>Use Mic</span></div>
      </div>
      <div id="presetControls">
        <div>Preset: <select id="presetSelect"></select></div>
        <div>Cycle: <input type="checkbox" id="presetCycle" checked></input><input type="number" id="presetCycleLength" step="1" value="15" min="1"></input></div>
        <div>Random: <input type="checkbox" id="presetRandom" checked></input></div>
      </div>
    </div>

    <div class="audio-player">
      <audio id="audioPlayer" controls autoplay>Your browser does not support the audio element.</audio>
      <button id="play-button">Play</button>
      <button id="pause-button">Pause</button>
      <button id="next-button">Next</button>
    </div>
    <script src="script.js"></script>

    <canvas id='canvas' width='1920' height='1080' style="display:block;"></canvas>
  </div>

  <script>
    $(function() {
      var visualizer = null;
      var rendering = false;
      var audioContext = null;
      var sourceNode = null;
      var delayedAudible = null;
      var cycleInterval = null;
      var presets = {};
      var presetKeys = [];
      var presetIndexHist = [];
      var presetIndex = 0;
      var presetCycle = true;
      var presetCycleLength = 15000;
      var presetRandom = true;
      var canvas = document.getElementById('canvas');
      var showPresetName = false;
      var audioPlayer = document.getElementById('audioPlayer');

      function connectToAudioAnalyzer(sourceNode) {
        if (delayedAudible) delayedAudible.disconnect();

        delayedAudible = audioContext.createDelay();
        delayedAudible.delayTime.value = 0.26;

        sourceNode.connect(delayedAudible);
        delayedAudible.connect(audioContext.destination);

        visualizer.connectAudio(delayedAudible);
      }

      function startRenderer() {
        requestAnimationFrame(() => startRenderer());
        visualizer.render();
      }

      function updateTitle() {
        $("#bgPresetTitle").html("<br>" + $("#presetSelect option:selected").text());
      }

      function nextPreset(blendTime = 5.7) {
        presetIndexHist.push(presetIndex);
        var numPresets = presetKeys.length;
        if (presetRandom) presetIndex = Math.floor(Math.random() * presetKeys.length);
        else presetIndex = (presetIndex + 1) % numPresets;
        
        visualizer.loadPreset(presets[presetKeys[presetIndex]], blendTime);
        $('#presetSelect').val(presetIndex);
        updateTitle();
      }

      function prevPreset(blendTime = 5.7) {
        var numPresets = presetKeys.length;
        if (presetIndexHist.length > 0) presetIndex = presetIndexHist.pop();
        else presetIndex = ((presetIndex - 1) + numPresets) % numPresets;
        
        visualizer.loadPreset(presets[presetKeys[presetIndex]], blendTime);
        $('#presetSelect').val(presetIndex);
        updateTitle();
      }

      function restartCycleInterval() {
        if (cycleInterval) {
          clearInterval(cycleInterval);
          cycleInterval = null;
        }
        if (presetCycle) cycleInterval = setInterval(() => nextPreset(2.7), presetCycleLength);
      }

      $(document).keydown((e) => {
        if (e.which === 32 || e.which === 39) nextPreset();
        else if (e.which === 8 || e.which === 37) prevPreset();
        else {
          let key = e.key.toLowerCase();
          switch (key) {
            case 'r': presetRandom = !presetRandom; break;
            case 'c': document.getElementById("presetCycle").click(); break;
            case 'h': toggleHelp(); break;
            case 't': togglePresetName(); break;
            case '9': prevPreset(0); break;
            case '0': nextPreset(0); break;
          }
        }
      });

      function toggleHelp() {
        var help = document.getElementById("help");
        if (help.style.visibility == "hidden") {
          help.style.visibility = 'visible';
          $("#bgPresetTitle").css('visibility', 'visible');
        } else {
          help.style.visibility = "hidden";
          updateTitleVisibility();
        }
      }

      function updateTitleVisibility() {
        $("#bgPresetTitle").css('visibility', showPresetName ? 'visible' : "hidden");
      }

      function togglePresetName() {
        showPresetName = !showPresetName;
        updateTitleVisibility();
      }

      $('#presetSelect').change(() => {
        presetIndexHist.push(presetIndex);
        presetIndex = parseInt($('#presetSelect').val());
        visualizer.loadPreset(presets[presetKeys[presetIndex]], 5.7);
      });

      $('#presetCycle').change(() => {
        presetCycle = $('#presetCycle').is(':checked');
        restartCycleInterval();
      });

      $('#presetCycleLength').change(() => {
        presetCycleLength = parseInt($('#presetCycleLength').val() * 1000);
        restartCycleInterval();
      });

      $('#presetRandom').change(() => {
        presetRandom = $('#presetRandom').is(':checked');
      });

      $("#localFileBut").click(() => {
        $("#audioSelectWrapper").css('display', 'none');
        var fileSelector = $('<input type="file" accept="audio/*" multiple />');
        fileSelector[0].onchange = function(event) {
          loadLocalFiles(fileSelector[0].files);
        }
        fileSelector.click();
      });

      function initPlayer() {
        var AudioContext = window.AudioContext || window.webkitAudioContext || false; 
        if (AudioContext) {
          var ctx = new AudioContext;
          audioContext = ctx;
        } else {
          alert("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox");
        }

        presets = {};
        if (window.butterchurnPresets) Object.assign(presets, butterchurnPresets.getPresets());
        if (window.butterchurnPresetsExtra) Object.assign(presets, butterchurnPresetsExtra.getPresets());
        presets = _(presets).toPairs().sortBy(([k, v]) => k.toLowerCase()).fromPairs().value();
        presetKeys = _.keys(presets);
        presetIndex = Math.floor(Math.random() * presetKeys.length);

        var presetSelect = document.getElementById('presetSelect');
        for (var i = 0; i < presetKeys.length; i++) {
          var opt = document.createElement('option');
          opt.innerHTML = presetKeys[i];
          opt.value = i;
          presetSelect.appendChild(opt);
        }

        visualizer = butterchurn.createVisualizer(audioContext, canvas, {
          width: window.innerWidth,
          height: window.innerHeight,
          pixelRatio: window.devicePixelRatio || 1,
        });

        visualizer.loadPreset(presets[presetKeys[presetIndex]], 0);
        $('#presetSelect').val(presetIndex);

        $(window).on('resize', () => {
          visualizer.setRendererSize(window.innerWidth, window.innerHeight);
        });

        audioPlayer.addEventListener('play', () => {
          if (!audioContext) {
            audioContext = new AudioContext();
          }
          if (!sourceNode) {
            sourceNode = audioContext.createMediaElementSource(audioPlayer);
            connectToAudioAnalyzer(sourceNode);
          }
          audioContext.resume().then(() => console.log('Playback resumed successfully'));
        });

        audioPlayer.addEventListener('pause', () => {
          audioContext.suspend().then(() => console.log('Playback paused successfully'));
        });

        audioPlayer.addEventListener('ended', () => {
          audioContext.close().then(() => {
            audioContext = null;
            sourceNode = null;
          });
        });

        startRenderer();
      }

      function loadLocalFiles(files) {
        var urlList = [];
        for (var i = 0; i < files.length; i++) {
          var url = URL.createObjectURL(files[i]);
          urlList.push(url);
        }
        var songIdx = 0;

        function playNextSong() {
          if (songIdx >= urlList.length) return;

          audioPlayer.src = urlList[songIdx++];
          audioPlayer.play();
        }

        audioPlayer.onended = playNextSong;
        songIdx = 0;
        playNextSong();
      }

      $(document).ready(function() {
        initPlayer();
      });
    });
      });
  </script>
<style>
    * { margin:0; padding:0; } /* to remove the top and left whitespace */

    html, body { width:100%; height:100%; } /* just to be sure these are full screen*/

    canvas {
        display: block; /* To remove the scrollbars */
    }
    /* // Lx */
    canvas {
        height: 100vh;
        width: 100vw;
        
        /*  center */
        /*
        padding-left: 0;
            padding-right: 0;
            margin-left: auto;
            margin-right: auto;
         */
    }
    /*
    // box-sizing: border-box; // Is this needed? // you might want to add box-sizing: border-box to your #canvas element too or it will render slightly off the screen
     */
    canvasOUT {
        height: 100%;
        width: 100%;
    }
</style>
</head>
<body style="width:100%; height:100%;">
  <div id="mainWrapper">
      <div id="LxSettings" style="display:none;">
    <div id="audioSelectWrapper">
      <div id="localFileBut">
        <span>Load local files</span>
      </div>
      <div id="micSelect">
        <span>Use Mic</span>
      </div>
    </div>
    <div id="presetControls">
      <div>Preset: <select id="presetSelect"></select></div>
      <div>Cycle: <input type="checkbox" id="presetCycle" checked></input>
                  <input type="number" id="presetCycleLength"step="1" value="15" min="1"></input></div>
      <div>Random: <input type="checkbox" id="presetRandom" checked></input></div>
    </div>
    </div>

<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="audio-player">
        <audio id="audioPlayer" controls autoplay>
            Your browser does not support the audio element.
        </audio>
        <button id="play-button">Play</button>
        <button id="pause-button">Pause</button>
        <button id="next-button">Next</button>
    </div>
    <script src="script.js"></script>
      
      <!-- Lx Help-->
<div id="container">
<div style="position:absolute; width:100%; height:100%; display:flex; align-items:center; text-align: center; justify-content: center;  overflow-y:auto">

<div id="text"> 
<div style="position:relative;">
<body onresize='document.getElementsByTagName("body")[0].style[ "font-size" ] = document.body.clientWidth*(12/1280) + "px";'>

<p style="line-height: 60%"><font size="+1vw"> <font color="#FFFFF0"> <marquee behavior="scroll" scrollamount="10" >

WWW.DJSPEEDSICK.COM<br>
</marquee></b>
	<br>
	<br>
	<br>
	<font color="#FFFFF0">
	<font size="0vw" ><ub>
		CONTACT:<br><font size="-2vw">
	<a href= "mailto:boettke@djspeedsick.com" style="color:rgb(127, 255, 212)">
		BOOKING</a><br>
	<a href= "mailto:noreply@djspeedsick.com" style="color:rgb(127, 255, 212)">PRESS</a><br>
	<a href= "mailto:777paranoia@gmail.com" style="color:rgb(127, 255, 212)">ART COMISSIONS</a><br><br>
		
	<font size="0vw">
	<img src="https://github.com/777paranoia/djspeedsick/blob/master/files/img/minicdr-small.png?raw=true">
<br>
Untitled 3" Business Card CD-R
<br>
SOLD OUT
<br>
<img src="https://github.com/777paranoia/djspeedsick/blob/master/files/img/death-trips-small.png?raw=true">
<br>
COMING SOON
<br>
Death Trips Vol. 1 Zine
<font size="0vw"><ub><br><br>UPCOMING SHOWS:<br><font size="-1vw"><br>
6/29: Summer Showdown 2024, Chicago, IL
<br>		&nbsp; &nbsp; w/ Mental Abortion, Triac, Discreet + more<br><br>
<font size="+0.5vw"><i>+ FALL TOUR WITH [???????]</i>
<br><font size="-2vw">[more info soon...]<br><br>

	
	<font size="+1vw">
        <a href= "https://www.djspeedsick.com/gallery.html" style="color:rgb(127, 255, 212)">ART GALLERY</a>

  	<br>
	<br><font size="-3vw">
	<a href= "https://www.soundcloud.com/speedsick" style="color:rgb(127, 255, 212)">SOUNDCLOUD</a><br>
	<a href= "https://djspeedsick.bandcamp.com" style="color:rgb(127, 255, 212)">BANDCAMP</a><br>
	<a href= "https://www.instagram.com/djspeedsick" style="color:rgb(127, 255, 212)">INSTAGRAM</a><br>
	<a href= "https://www.x.com/djspeedsick" style="color:rgb(127, 255, 212)">X</a><br>
	<a href= "https://open.spotify.com/artist/6CZm9kdgqsQmxDrp6OHmxX" style="color:rgb(127, 255, 212)">SPOTIFY</a><br>
	<a href= "https://www.discogs.com/artist/5782732-DJ-Speedsick" style="color:rgb(127, 255, 212)">DISCOGS</a><br>
</p>
</div>
</div>  
</div>      
    
<!-- Lx HD-->
<!--    <canvas id='canvas' width='1280' height='720' style="display:block;">-->
<!-- Lx FHD-->
    <canvas id='canvas' width='1920' height='1080' style="display:block;">
<!-- Lx 1440p-->
<!--    <canvas id='canvas' width='2560' height='1440' style="display:block;">-->
<!-- Lx 4K-->
<!--    <canvas id='canvas' width='3840' height='2160' style="display:block;">-->
    </canvas>
  </div>
</body>
</html>
