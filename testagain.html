<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Butterchurn Visualizer</title>
    <link rel="stylesheet" href="https://unpkg.com/normalize.css/normalize.css" />
    <style>
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: black;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://unpkg.com/lodash/lodash.min.js"></script>
    <script src="https://unpkg.com/butterchurn/butterchurn.min.js"></script>
    <script src="https://unpkg.com/butterchurn-presets/lib/butterchurnPresets.min.js"></script>
    <script src="https://unpkg.com/butterchurn-presets/lib/butterchurnPresetsExtra.min.js"></script>
    <script>
        $(document).ready(function () {
            var canvas = document.getElementById('canvas');
            var audioContext = new (window.AudioContext || window.webkitAudioContext)();
            var visualizer = butterchurn.default.createVisualizer(audioContext, canvas, {
                width: window.innerWidth,
                height: window.innerHeight,
                pixelRatio: window.devicePixelRatio || 1,
            });

            var presets = Object.assign({}, butterchurnPresets.getPresets(), butterchurnPresetsExtra.getPresets());
            var presetKeys = _.keys(presets);
            console.log('Presets loaded:', presetKeys);
            visualizer.loadPreset(presets[presetKeys[0]], 0);

            function renderFrame() {
                visualizer.render();
                requestAnimationFrame(renderFrame);
            }

            requestAnimationFrame(renderFrame);

            $(window).resize(function () {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                if (visualizer) {
                    visualizer.setRendererSize(canvas.width, canvas.height);
                }
            });

            // Initialize canvas size
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
